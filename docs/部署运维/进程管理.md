# è¿›ç¨‹ç®¡ç†å’Œåƒµå°¸è¿›ç¨‹é¢„é˜²æŒ‡å—

## ğŸ¯ ç›®æ ‡

è‡ªåŠ¨åŒ–æ£€æµ‹ã€é¢„é˜²å’Œæ¸…ç†åƒµå°¸è¿›ç¨‹ï¼Œç¡®ä¿å¼€å‘ç¯å¢ƒç¨³å®šè¿è¡Œã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ¨èæ–¹å¼ 1ï¼šä½¿ç”¨å®‰å…¨å¯åŠ¨ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰

```bash
npm run dev:safe
```

**ç‰¹ç‚¹ï¼š**
- âœ… è‡ªåŠ¨æ£€æµ‹å¹¶æ¸…ç†ç«¯å£å ç”¨
- âœ… è‡ªåŠ¨å¯åŠ¨å¼€å‘æœåŠ¡å™¨
- âœ… é›¶é…ç½®ï¼Œä¸€é”®å¯åŠ¨

---

### æ¨èæ–¹å¼ 2ï¼šä½¿ç”¨ PM2ï¼ˆç”Ÿäº§çº§ç®¡ç†ï¼‰

```bash
# é¦–æ¬¡ä½¿ç”¨éœ€è¦å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨æœåŠ¡
npm run dev:pm2

# æŸ¥çœ‹çŠ¶æ€
npm run status

# æŸ¥çœ‹æ—¥å¿—
npm run logs

# é‡å¯æœåŠ¡
npm run restart

# åœæ­¢æœåŠ¡
npm run stop
```

**ç‰¹ç‚¹ï¼š**
- âœ… è‡ªåŠ¨é‡å¯ï¼ˆå´©æºƒæ¢å¤ï¼‰
- âœ… å†…å­˜ç›‘æ§ï¼ˆè¶…è¿‡ 1G è‡ªåŠ¨é‡å¯ï¼‰
- âœ… æ—¥å¿—ç®¡ç†
- âœ… è¿›ç¨‹ç›‘æ§é¢æ¿

---

## ğŸ”§ å¯ç”¨å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `npm run dev` | æ ‡å‡†å¯åŠ¨ | æ­£å¸¸å¼€å‘ |
| `npm run dev:safe` | å®‰å…¨å¯åŠ¨ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰ | **æ¨èæ—¥å¸¸ä½¿ç”¨** |
| `npm run dev:pm2` | PM2 å¯åŠ¨ | éœ€è¦è¿›ç¨‹ç®¡ç† |
| `npm run dev:check` | å¥åº·æ£€æŸ¥ | è¯Šæ–­é—®é¢˜ |
| `npm run cleanup` | æ¸…ç†åƒµå°¸è¿›ç¨‹ | æ‰‹åŠ¨æ¸…ç† |
| `npm run status` | æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€ | ç›‘æ§ |
| `npm run logs` | æŸ¥çœ‹æ—¥å¿— | è°ƒè¯• |
| `npm run stop` | åœæ­¢æœåŠ¡ | å…³é—­ PM2 |
| `npm run restart` | é‡å¯æœåŠ¡ | æ›´æ–°ä»£ç  |

---

## ğŸ“Š å·¥ä½œæµç¨‹

### æµç¨‹ 1ï¼šæ—¥å¸¸å¼€å‘ï¼ˆæ¨èï¼‰

```bash
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
npm run dev:safe

# 2. ç¼–å†™ä»£ç ...

# 3. å®Œæˆåç›´æ¥ Ctrl+C å…³é—­
```

### æµç¨‹ 2ï¼šä½¿ç”¨ PM2ï¼ˆè¿›é˜¶ï¼‰

```bash
# 1. å¯åŠ¨æœåŠ¡
npm run dev:pm2

# 2. åœ¨åå°è¿è¡Œï¼Œå¯ä»¥å…³é—­ç»ˆç«¯

# 3. éœ€è¦æ—¶æŸ¥çœ‹æ—¥å¿—
npm run logs

# 4. å®Œæˆååœæ­¢
npm run stop
```

### æµç¨‹ 3ï¼šé‡åˆ°é—®é¢˜æ—¶

```bash
# 1. æ£€æŸ¥å¥åº·çŠ¶æ€
npm run dev:check

# 2. å¦‚æœå‘ç°åƒµå°¸è¿›ç¨‹
npm run cleanup

# 3. é‡æ–°å¯åŠ¨
npm run dev:safe
```

---

## ğŸ›¡ï¸ è‡ªåŠ¨åŒ–ä¿æŠ¤æœºåˆ¶

### 1. å¯åŠ¨å‰è‡ªåŠ¨æ£€æŸ¥

`dev:safe` å‘½ä»¤ä¼šï¼š
- âœ… æ£€æµ‹ç«¯å£å ç”¨
- âœ… æµ‹è¯•æœåŠ¡å™¨å¥åº·
- âœ… è‡ªåŠ¨æ¸…ç†åƒµå°¸è¿›ç¨‹
- âœ… å®‰å…¨å¯åŠ¨æœåŠ¡

### 2. PM2 è‡ªåŠ¨æ¢å¤

PM2 é…ç½®äº†ï¼š
- âœ… å´©æºƒè‡ªåŠ¨é‡å¯
- âœ… å†…å­˜è¶…é™è‡ªåŠ¨é‡å¯ï¼ˆ> 1GBï¼‰
- âœ… æœ€å¤šé‡å¯ 10 æ¬¡
- âœ… 5 ç§’ä¼˜é›…å…³é—­è¶…æ—¶

### 3. å¥åº·æ£€æŸ¥è„šæœ¬

è‡ªåŠ¨æ£€æµ‹ï¼š
- âœ… ç«¯å£å ç”¨æƒ…å†µ
- âœ… HTTP å“åº”çŠ¶æ€
- âœ… å“åº”æ—¶é—´
- âœ… åƒµå°¸è¿›ç¨‹è¯†åˆ«

---

## ğŸ” é—®é¢˜è¯Šæ–­

### é—®é¢˜ 1ï¼šç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥å¥åº·çŠ¶æ€
npm run dev:check

# è¾“å‡ºç¤ºä¾‹ï¼š
# ğŸ§Ÿ æ£€æµ‹åˆ°åƒµå°¸è¿›ç¨‹ï¼
#    PID: 496944
#    ç«¯å£: 3008
#    çŠ¶æ€: æ— å“åº”

# è‡ªåŠ¨æ¸…ç†
npm run cleanup
```

### é—®é¢˜ 2ï¼šæœåŠ¡æ— å“åº”

```bash
# æŸ¥çœ‹æ—¥å¿—
npm run logs

# å¦‚æœä½¿ç”¨ PM2ï¼Œé‡å¯æœåŠ¡
npm run restart

# å¦‚æœæœªä½¿ç”¨ PM2ï¼Œæ¸…ç†åé‡å¯
npm run cleanup
npm run dev:safe
```

### é—®é¢˜ 3ï¼šå†…å­˜æº¢å‡º

```bash
# PM2 ä¼šè‡ªåŠ¨é‡å¯
# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤
npm run logs

# æ‰‹åŠ¨é‡å¯
npm run restart
```

---

## ğŸ“ æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **æ—¥å¸¸å¼€å‘ä½¿ç”¨ `dev:safe`**
   ```bash
   npm run dev:safe
   ```

2. **é•¿æ—¶é—´è¿è¡Œä½¿ç”¨ PM2**
   ```bash
   npm run dev:pm2
   ```

3. **é‡åˆ°é—®é¢˜å…ˆæ£€æŸ¥**
   ```bash
   npm run dev:check
   ```

4. **å®šæœŸæŸ¥çœ‹æ—¥å¿—**
   ```bash
   npm run logs
   ```

### âŒ é¿å…åšæ³•

1. âŒ ä¸è¦ä½¿ç”¨åå°è¿è¡Œæ¨¡å¼ï¼ˆ`&`ï¼‰
2. âŒ ä¸è¦å¼ºåˆ¶å…³é—­ç»ˆç«¯è€Œä¸åœæ­¢æœåŠ¡
3. âŒ ä¸è¦å¿½ç•¥ç«¯å£å ç”¨è­¦å‘Š
4. âŒ ä¸è¦åŒæ—¶è¿è¡Œå¤šä¸ªå¼€å‘æœåŠ¡å™¨

---

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰ PM2 é…ç½®

ç¼–è¾‘ `ecosystem.config.js`ï¼š

```javascript
module.exports = {
  apps: [{
    name: 'ai-travel-planner',
    // ä¿®æ”¹å†…å­˜é™åˆ¶
    max_memory_restart: '2G',  // æ”¹ä¸º 2GB

    // ä¿®æ”¹é‡å¯æ¬¡æ•°
    max_restarts: 5,

    // æ·»åŠ ç¯å¢ƒå˜é‡
    env: {
      NODE_ENV: 'development',
      PORT: 3008,
      DEBUG: 'app:*'  // å¯ç”¨è°ƒè¯•æ—¥å¿—
    }
  }]
};
```

### è‡ªå®šä¹‰å¥åº·æ£€æŸ¥

ç¼–è¾‘ `scripts/health-check.js`ï¼š

```javascript
const MAX_RESPONSE_TIME = 10000; // æ”¹ä¸º 10 ç§’
```

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `ecosystem.config.js` - PM2 é…ç½®
- `scripts/health-check.js` - å¥åº·æ£€æŸ¥è„šæœ¬
- `scripts/dev-safe.sh` - Linux/Mac å¯åŠ¨è„šæœ¬
- `scripts/dev-safe.bat` - Windows å¯åŠ¨è„šæœ¬
- `package.json` - NPM è„šæœ¬å®šä¹‰

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: PM2 å‘½ä»¤æ‰¾ä¸åˆ°ï¼Ÿ

```bash
# å…¨å±€å®‰è£… PM2
npm install -g pm2
```

### Q: æƒé™ä¸è¶³ï¼Ÿ

Windows: ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
Linux/Mac: ä½¿ç”¨ `sudo`

### Q: å¥åº·æ£€æŸ¥å¤±è´¥ï¼Ÿ

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
node scripts/health-check.js

# æ‰‹åŠ¨æ¸…ç†
taskkill /F /PID [PID]  # Windows
kill -9 [PID]           # Linux/Mac
```

### Q: PM2 æ— æ³•å¯åŠ¨ï¼Ÿ

```bash
# åˆ é™¤ PM2 ç¼“å­˜
pm2 kill

# é‡æ–°å¯åŠ¨
npm run dev:pm2
```

---

## ğŸ’¡ æç¤º

- ä½¿ç”¨ `dev:safe` å¯ä»¥é¿å… 99% çš„åƒµå°¸è¿›ç¨‹é—®é¢˜
- PM2 é€‚åˆéœ€è¦é•¿æ—¶é—´è¿è¡Œçš„åœºæ™¯
- å®šæœŸè¿è¡Œ `npm run dev:check` å¯ä»¥åŠæ—©å‘ç°é—®é¢˜
- æ—¥å¿—æ–‡ä»¶ä½äº `logs/` ç›®å½•ï¼ˆä½¿ç”¨ PM2 æ—¶ï¼‰

---

**æ¨èï¼š** å°† `npm run dev:safe` è®¾ä¸ºé»˜è®¤å¼€å‘å‘½ä»¤ï¼
